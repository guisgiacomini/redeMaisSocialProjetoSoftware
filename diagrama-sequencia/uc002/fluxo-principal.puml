@startuml
actor "Cliente" as ator
participant "GUI" as gui <<fronteira>>
participant ":AfiliacaoController" as controller <<controle>>
participant ":Candidato" as candidato <<entidade>>
participant ":PedidoAfiliacao" as afiliacao <<entidade>>
participant ":EmailValidador" as emailValidador <<entidade>>
collections "Candidato" as collectionCandidato


ator -> gui: solicitaAfiliacao(email, cpf)
activate gui
gui -> controller: solicitaAfiliacao(email, cpf)
activate controller

controller -> collectionCandidato: buscarPorEmailOuCPF(email, cpf)
activate collectionCandidato
collectionCandidato --> controller: naoEncontrado
destroy collectionCandidato

controller -> afiliacao **: criarPedidoAfiliacao()
activate afiliacao
afiliacao --> controller: pedidoCriado
deactivate afiliacao

controller --> gui: exibirFormularioIdentificacao()
deactivate controller
deactivate gui

' --- Preenchimento e validação dos dados ---
ator -> gui: informaDadosIdentificacao(nome, sexo, data_nascimento, nacionalidade, endereco, profissao)
activate gui
gui -> controller: validarDadosIdentificacao(dados)
activate controller

controller -> candidato **: criarCandidato(dados)
activate candidato
candidato --> controller: candidatoCriado
deactivate candidato

controller -> afiliacao: associarCandidato(candidato)
afiliacao --> controller: associado

controller -> gui: exibirFormularioPerfilHabilidades()
deactivate controller
deactivate gui

' --- Preenchimento do perfil ---
ator -> gui: informaPerfilEInteresses(perfil, habilidades)
activate gui
gui -> controller: validarPerfil(perfil, habilidades)
activate controller

controller -> candidato: armazenarPerfil(perfil, habilidades)
activate candidato
candidato --> controller: perfilArmazenado
deactivate candidato

controller -> gui: exibirTermoCompromisso()
deactivate controller
deactivate gui

' --- Aceite do termo ---
ator -> gui: aceitaTermo()
activate gui
gui -> controller: registrarAceite()
activate controller

controller -> candidato: atualizarSituacao("Aguardando Validação")
controller -> emailValidador **: enviarLinkValidacao(email)
deactivate controller
deactivate gui

@enduml
