@startuml
actor "Candidato" as ator
participant "GUI" as gui <<fronteira>>
participant ":AfiliacaoController" as controller <<controle>>
participant ":Candidato" as candidato <<entidade>>
participant ":PedidoAfiliacao" as pedido <<entidade>>
participant ":EmailValidador" as emailValidador <<entidade>>
participant ":Perfil" as perfil <<entidade>>
participant ":Habilidade" as habilidade <<entidade>>
participant ":Interesse" as interesse <<entidade>>
participant ":TermoDeCompromisso" as termo <<entidade>>

collections "Candidatos" as collectionCandidato <<coleção>>

' --- Solicitação de afiliação ---
ator -> gui: solicitaAfiliacao(email, cpf)
activate gui
gui -> controller: solicitaAfiliacao(email, cpf)
activate controller

controller -> collectionCandidato: buscarPorEmailOuCPF(email, cpf)
activate collectionCandidato
collectionCandidato --> controller: naoEncontrado
deactivate collectionCandidato

controller -> pedido **: criarPedidoAfiliacao()
activate pedido
pedido --> controller: pedidoCriado
deactivate pedido

controller -> candidato: atualizaDados(email, cpf)
activate candidato
candidato --> controller: candidato
deactivate candidato

controller -> pedido: associarCandidato(candidato)
activate pedido
pedido --> controller: candidatoAssociado
deactivate pedido

controller --> gui: exibirFormularioIdentificacao()
deactivate controller
deactivate gui

' --- Preenchimento e validação dos dados ---
ator -> gui: informaDadosIdentificacao(nome, sexo, data_nascimento, nacionalidade, endereco, profissao)
activate gui
gui -> controller: validarDadosIdentificacao(dados)
activate controller

controller -> candidato: atualizaDados(dados)
activate candidato
candidato --> controller: dadosValidados
deactivate candidato

controller --> gui: exibirFormularioPerfilHabilidades()
deactivate controller
deactivate gui

' --- Preenchimento do perfil ---
ator -> gui: informaPerfilEInteresses(perfil, habilidades, interesses)
activate gui
gui -> controller: validarPerfil(perfil, habilidades, interesses)
activate controller

controller -> candidato: armazenarPerfil(perfil, habilidades, interesses)
activate candidato
candidato --> perfil ** : <<create>>
candidato --> habilidade ** : <<create>>
candidato --> interesse ** : <<create>>
candidato --> controller: perfilArmazenado
deactivate candidato

controller --> gui: exibirTermoCompromisso()
deactivate controller
deactivate gui

' --- Aceite do termo ---
ator -> gui: aceitaTermo()
activate gui
gui -> controller: registrarAceite()
activate controller

controller -> termo: aceita()
termo --> controller: termoAceito

controller -> candidato: atualizarSituacao("Aguardando Validação")
controller -> emailValidador **: enviarLinkValidacao(email)
deactivate controller
deactivate gui

@enduml
